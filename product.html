<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Product Details - Chitralaya</title>
  <link rel="icon" href="assets/favicon.svg" type="image/svg+xml">
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari&family=Playfair+Display&display=swap"
      rel="stylesheet"/>
    <link rel="stylesheet" href="chitra.css" />
    <script src="config.js"></script>
    <script src="script.js"></script>
  </head>

  <body>
    <div class="header-container">
    <div class="navbar">
      <div class="logo">
        <span>‡§ö‡§ø‡§§‡•ç‡§∞‡§æ‡§≤‡§Ø|</span><span class="en">Chitralaya</span
        ><span class="icon">üé®</span>
      </div>

      <div class="nav-links">
        <a href="main.html#home">Home</a>
        <a href="main.html#gallery">Gallery</a>
        <a href="main.html#about">About</a>
        <a href="main.html#contact">Contact</a>
        </div>
      </div>

      <!-- User Actions -->
      <div class="user-actions">
        <a href="login.html" class="user-action-btn" id="user-link">
          <img src="assets/user.png" alt="Login" class="icon-img">
          <span id="user-text">Login</span>
        </a>
        <a href="cart.html" class="user-action-btn cart-btn">
          <img src="assets/shopping-cart.png" alt="Cart" class="icon-img">
          <span>Cart</span>
          <span class="cart-count" id="cart-count">0</span>
        </a>
      </div>
    </div>

    <!-- Breadcrumb -->
    <div class="breadcrumb">
      <a href="main.html">Home</a> ‚Ä∫ <a href="main.html#gallery">Gallery</a> ‚Ä∫ <span id="product-breadcrumb">Product</span>
    </div>

    <!-- Product Section -->
    <div class="product-container">
      <div class="product-gallery">
        <div class="main-image">
          <img id="main-product-image" src="assets/2.jpeg" alt="Product Image">
        </div>
        <div class="thumbnail-gallery" id="thumbnail-gallery">
          <!-- Thumbnails will be dynamically loaded based on the product -->
        </div>
      </div>

      <div class="product-details">
        <h1 id="product-title">Divine Vishnu and Lakshmi</h1>
        <div class="price-section">
          <div class="current-price">Rs. 2,349.00</div>
        </div>

        <div class="product-description">
          <h4>Product Description</h4>
          <p>Behold the divine presence of Lord Vishnu and Goddess Lakshmi in this sacred artwork, beautifully capturing the spiritual essence and divine grace of these revered Hindu deities.</p>
        </div>

        <div class="product-details">
          <h4>Product Details</h4>
          <div class="product-specifications">
            <div class="spec-item">
              <label>Size:</label>
              <span class="spec-value" id="product-size">24X12 inches</span>
            </div>
            <div class="spec-item">
              <label>Medium:</label>
              <span class="spec-value" id="product-medium">Canvas</span>
            </div>
          </div>
        </div>


        <div class="action-buttons">
          <button class="add-to-cart-btn" onclick="addToCart()">Add to Cart</button>
          <button class="buy-now-btn" onclick="buyNow()">Buy Now</button>
        </div>

        <!-- Toast Notification -->
        <div id="toast" class="toast">
          <div class="toast-content">
            <span class="toast-icon">‚úì</span>
            <span class="toast-message">Added to Cart!</span>
          </div>
        </div>

        <div class="shipping-info">
          <p>‚úì Original Artwork Made on Request</p>
          <p>‚úì Artist begins creation after order placement</p>
          <p>‚úì Customization options available during checkout</p>
          <p>‚úì Free Shipping across India</p>
          <p>‚úì Delivery can take up to 10+ days</p>
        </div>
      </div>
    </div>


    <!-- Footer -->
    <footer class="footer" id="about">
      <div class="footer-content">
        <div class="footer-section">
          <h3>About Chitralaya</h3>
          <p>Welcome to Chitralaya ‚Äî where colors speak. We showcase the original artworks created by my mother, each piece crafted with love and creativity. All artworks displayed here are available for purchase directly through our site.</p>
        </div>
        
        <div class="footer-section" id="contact">
          <h3>Contact Us</h3>
          <p>Get in touch with us for any inquiries about our artwork collection.</p>
          <div class="social-links">
            <a href="mailto:mannu131376@gmail.com?subject=Inquiry from Chitralaya Website&body=Hello, I am interested in your artwork collection. Please contact me with more information." class="social-link">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
              </svg>
              <span>Email</span>
            </a>
            <a href="https://instagram.com/pratishtha0605" class="social-link">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
              </svg>
              <span>Instagram</span>
            </a>
          </div>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2025 Chitralaya. All rights reserved.</p>
      </div>
    </footer>

    <script>
      // Product page functionality
      function changeMainImage(src) {
        document.getElementById('main-product-image').src = src;
        document.querySelectorAll('.thumbnail').forEach(thumb => thumb.classList.remove('active'));
        event.target.classList.add('active');
      }


      function addToCart() {
        // Use real product data if available, otherwise fallback to hardcoded
        if (window.currentProduct) {
          const product = window.currentProduct;
          
          // Get existing cart or create new one
          let cart = JSON.parse(localStorage.getItem('cart')) || [];
          
          // Check if item already exists in cart
          const existingItem = cart.find(item => item.id === product._id);
          
          if (existingItem) {
            existingItem.quantity += 1;
          } else {
            cart.push({
              id: product._id,
              title: product.name,
              price: product.price, // Store as number for calculations
              priceFormatted: product.price.toLocaleString('en-IN', {minimumFractionDigits: 2}), // For display
              image: product.images[0],
              quantity: 1
            });
          }
          
          // Save to localStorage
          localStorage.setItem('cart', JSON.stringify(cart));
          
          // Show toast notification
          showToast();
          
          // Trigger storage event for cart page
          window.dispatchEvent(new StorageEvent('storage', {
            key: 'cart',
            newValue: JSON.stringify(cart)
          }));
          
          // Trigger custom cart update event
          window.dispatchEvent(new CustomEvent('cartUpdated'));
          
          return;
        }
        
        // Show error if no product data is available
        showToast('Product data not loaded. Please refresh the page.');
      }

      function buyNow() {
        // Add item to cart first
        addToCart();
        
        // Redirect to checkout after a short delay
        setTimeout(() => {
          window.location.href = 'checkout.html';
        }, 1000);
      }

      function showToast() {
        const toast = document.getElementById('toast');
        toast.classList.add('show');
        
        // Hide toast after 3 seconds
        setTimeout(() => {
          toast.classList.remove('show');
        }, 3000);
      }


      // Load product data from URL parameters
      window.addEventListener('load', function() {
        // Check user login status first
        console.log('Product page loaded, checking user status...');
        if (typeof checkUserStatus === 'function') {
          console.log('checkUserStatus function found, calling it...');
          checkUserStatus();
        } else {
          console.log('checkUserStatus function not found!');
        }
        
        // Update cart counter
        updateCartCounter();
        
        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get('id');
        
        if (productId) {
          // Load product data based on ID
          loadProductData(productId);
        }
      });

      // Update cart counter function
      function updateCartCounter() {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
        const cartCountElement = document.getElementById('cart-count');
        if (cartCountElement) {
          cartCountElement.textContent = totalItems;
          cartCountElement.style.display = totalItems > 0 ? 'flex' : 'none';
        }
      }

      // Listen for cart changes
      window.addEventListener('storage', function(e) {
        if (e.key === 'cart') {
          updateCartCounter();
        }
      });
      
      // Listen for custom cart update events
      window.addEventListener('cartUpdated', function() {
        updateCartCounter();
      });

      async function loadProductData(productId) {
        try {
          // Fetch product data from API
          const response = await fetch(`${window.API_BASE_URL}/products/${productId}`);
          const data = await response.json();
          
          if (data.success) {
            const product = data.data.product;
            displayProductData(product);
          } else {
            showProductError('Product not found');
          }
        } catch (error) {
          console.error('Error loading product:', error);
          showProductError('Error loading product. Please try again.');
        }
      }

      function displayProductData(product) {
        document.getElementById('product-title').textContent = product.name;
        document.querySelector('.current-price').textContent = `Rs. ${product.price.toLocaleString('en-IN', {minimumFractionDigits: 2})}`;
        
        // Use original image path
        const mainImagePath = product.images[0];
        document.getElementById('main-product-image').src = mainImagePath;
        
        document.querySelector('.product-description p').textContent = product.description;
        document.getElementById('product-breadcrumb').textContent = product.name;
        
        // Update size and medium information
        if (product.size) {
          document.getElementById('product-size').textContent = product.size;
        }
        if (product.medium) {
          document.getElementById('product-medium').textContent = product.medium;
        }
        
        // Create thumbnail gallery dynamically
        createThumbnailGallery(product);
        
        // Update addToCart function to use real product data
        updateAddToCartFunction(product);
      }

      function updateAddToCartFunction(product) {
        // Store product data globally for addToCart function
        window.currentProduct = product;
      }

      function showProductError(message) {
        document.getElementById('product-title').textContent = 'Product Not Found';
        document.querySelector('.product-description p').textContent = message;
      }


      function createThumbnailGallery(product) {
        const thumbnailGallery = document.getElementById('thumbnail-gallery');
        thumbnailGallery.innerHTML = ''; // Clear existing thumbnails
        
        // Add main image as first thumbnail
        const mainThumbnail = document.createElement('img');
        mainThumbnail.className = 'thumbnail active';
        const mainImagePath = product.images[0];
        mainThumbnail.src = mainImagePath;
        mainThumbnail.alt = product.name;
        mainThumbnail.onclick = function() { changeMainImage(this.src); };
        thumbnailGallery.appendChild(mainThumbnail);
        
        // Add hover image as second thumbnail (if different from main image)
        if (product.images[1] && product.images[1] !== product.images[0]) {
          const hoverThumbnail = document.createElement('img');
          hoverThumbnail.className = 'thumbnail';
          const hoverImagePath = product.images[1];
          hoverThumbnail.src = hoverImagePath;
          hoverThumbnail.alt = product.name + ' Detail';
          hoverThumbnail.onclick = function() { changeMainImage(this.src); };
          thumbnailGallery.appendChild(hoverThumbnail);
        }
      }
    </script>
  </body>
</html>
